---
title: 'A Handbook on R'
author: "Freddy Ray Drennan"
date: "`r Sys.Date()`"
output: pdf_document
documentclass: book
bibliography:
- book.bib
- packages.bib
biblio-style: apalike
link-citations: yes
description: A labor of love about R
site: bookdown::bookdown_site
---

# Introduction

## R is a Functional Language

A function does stuff given a set of inputs. Remember seeing equations like $y = 2x + 3$ in algebra? We said given $x=2$ then $y=7$. because $2(2) + 3 = 7$. In calculus, equations became functions with a slightly different syntax. $f(x) = 2x + 3$. What happened to the $y$? Well, nothing really. We can say $y=f(x)=x^2$ or $result=f(x)$ or $z=g(x,y)=x + min(x, y)$. Once we have these definitions, we can go further and compose them together. For example, $f(g(x, y)) = (x + min(x, y))^2$. Now, the outputs of functions become the inputs for other functions.

```{r}
library(cli)

# Same as f(x) = 2x + 3
f <-  function(x) {
  x <- x * x
  x
}

g <- function(x=NULL, y=NULL) {
  result <- x + min(x, y)
  result
}

print(f(g(3, 4)))
```

We now have a way of describing inputs and output a little more clearly. Instead of writing, $(3 + min(3, 4)) * (3 + min(3, 4))$ we can write $f(g(3, 4))$ or try new creations like $z(x, y)=f(g(f(x), f(y)))$ so $z(1, 2)=f(g(f(1), f(2)))=f(g(1, 4))=f(2)=4$. \
\
Now just take this idea about functions and expand your definition of inputs and outputs to be any number, none or many, and of any type that R supports - character, numeric, date/time, data.frame or list - all of which we'll cover.

# Solve a Problem in R

Let's solve a problem using R. Suppose we have a friend that is interested in the current trend regarding COVID-19 cases. The first thing we will probably do is try to figure out an efficient and reliable way for importing Covid-19 data into our R session. Conveniently, the [`COVID19`](https://covid19datahub.io/articles/r.html) package allows us to pull the latest data without any hard work and consists of one function - `covid19`.

### Installing Packages

In your RStudio console, you can write the following to install the `COVID19` package using the `install.packages` function. If you are interested in learning more about this function, you can write `?install.packages` in your console and the documentation for the function will appear.

```{r, eval=FALSE}
# For help menu, uncomment next line
# ?install.packages 

# If the package is not yet installed, you can install it by passing 
# a string with the package name to the `install.packages` function
install.packages(pkgs = c('COVID19'))
```

### Available Packages on CRAN

\
For a full list of what packages are available through the `install.packages` function, please check out the [Contributed Packages](https://cran.r-project.org/web/packages/index.html) page at CRAN or scrape it yourself. \

```{r}
library(rvest)
cran_packages <- 'https://cran.r-project.org/web/packages/available_packages_by_date.html'
package_data <- html_table(html_element(read_html(cran_packages), 'table'))
print(package_data)
n_packages <- length(unique(package_data$Package))
cli_alert_info('There are {n_packages} packages on CRAN')
```

## Using Functions to Solve a Problem

\
The two lines of code below consist of three functions. The first two are `library` and `covid19`, but the third is hidden - it's actually the arrow, `<-` and I will show you why in time! *Functions* are spaces for stuff to happen. Functions help us make common procedures repeatable. By creating a function with a particular name and inputs, we can get some sort of useful (or not useful, the world's your oyster) output.

In this case, `library` loads *packages* from a folder in the R environment called library. You can see which ones your R environment knows about by running the function `.libPaths()`. `covid19` is a function from the `COVID19` package, and would only be available after executing `library(COVID19)` or if `library(COVID19)` is omitted, by pulling it from the package namespace directly by preceding the function with the package name and two colons like so: `COVID19::covid19`. Generally speaking, you simply use `library` because it reduces the amount of text on the page.

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(COVID19)
covid_data <- covid19(
    country = 'United States', 
    start = '2021-01-01', 
    end = "2021-11-21",
    verbose = FALSE, 
    level = 2
)
```

```{r}
glimpse(covid_data)
```

[How do I know if a function is vectorized](https://stackoverflow.com/questions/58568392/how-do-i-know-a-function-or-an-operation-in-r-is-vectorized#:~:text=To%20identify%20if%20an%20R%20object%20is%20a%20vector%20%2C%20I,a%20vector%20or%20False%20otherwise.)

## Initial Setup

[Book Outline](https://hackmd.io/vGRGEPo8QQyiG8gecWv71g)

-   [Install R](https://cran.r-project.org/)

-   [Install R Studio](https://www.rstudio.com/products/rstudio/download/)

-   [Windows Only: Install RTools](https://cran.r-project.org/bin/windows/Rtools/)

    -   When installed, run in the RStudio Console: `write('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', file = "~/.Renviron", append = TRUE)`

-   [Windows Only: Install WSL2](https://www.omgubuntu.co.uk/how-to-install-wsl2-on-windows-10)

    -   Computer should be completely updated before install.

-   [Install Git](https://git-scm.com/downloads)

-   [Create Github Account](https://github.com/)

-   [Fork r-handbook](https://github.com/fdrennan/r-handbook)

-   [Install Docker and Docker Compose](https://docs.docker.com/get-docker/)

-   [Create AWS Account](https://aws.amazon.com/)

    -   Billing will be discussed in the course, but don't expect to pay much - i.e., 10-20 dollars a month for high course activity.
    -   Remember to `stop` EC2 servers when we begin using them. AWS is polite about your first few refund requests.

-   [Create Reddit Account](reddit.com)

    -   [Follow Instructions here](https://towardsdatascience.com/how-to-use-the-reddit-api-in-python-5e05ddfd1e5c)

Make sure you install the [`tidyverse`](https://www.tidyverse.org/) packages. Update to renv later.

```{r eval=FALSE}
install.packages('tidyverse')
```
